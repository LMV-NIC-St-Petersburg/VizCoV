# Annual lineage plotting

## annual_lineage_hist.R

This script allows you to plot histogram with share of strains grouped by months

#### Parameters

|name|type|description|example|
|----|:--:|-----------|-------|
|`data_folder`|str|Relative path from the script to the folder containing files. It is appended to each filename|`""`|
|`input_filenames`|vector[str]|List of the files to load data from|`c("file1.tsv", "subfolder/file2.tsv")`|
|`picture_filename`|str|Name of the resulting image`|"output"`|
|`picture_width`|int|Image width in pixels|`800`|
|`picture_height`|int|Image height in pixels|`800`|
|`lineage_legend_title`|str|Title of the lineage list on plot|`"Strains"`|
|`n_signif_digits`|int|Number of significant digits of each strain's share is being rounded up|`2`|
|`year`|str (!)|Year of the collection date to select. All records of the other years are filtered out|`"2020"`|
|`groups`|list[vector[str]]|(optional) List of strains gathered in groups|`list(c("A.1","A.2"), c("B"))`|
|`group_names`|vector[str]|(optional) Strain groups titles, must be the same length as the `groups`|`c("g1", "g2")`|
|`supergroup_name`|str|(optional) Common title for all groups. All strains not mentioned in `groups` will be marked as "Not [`supergroup_name`]"|`"my groups"`|
|`percent_threshold_to_label`|double|Cutoff for the strain share to be labeled on plot|`.05`|
|`percent_threshold_to_draw`|double|Cutoff for the strain share to be colored on plot (if the share is too low, strain is colored as "Others")|`.05`|
|`count_threshold_to_draw`|int|Cutoff for the strain samples count to be colored on plot (if the share is too low, strain is colored as "Others")|`10`|

##### Notes: 
- both `count_threshold_to_draw` and `percent_threshold_for_draw` must be exceeded in at least one month for the strain to be drawn
- all files in the `input_filenames` should have .tsv extension and contain `lineage` and `collection_date` columns with `collection_date` in POSIX format
- bracket, asterisk and space symbols are being removed from the `lineage` column records

#### Example

See the script usage example, downloading the whole "annual lineage plots" folder and running annual_lineage_hist.R

Folder "example" contains Covid data for Russian Federation and Crime from the GISAID initiative for the part of the 2024 and three images with the plots generated by this script 

![plot](./annual%20lineage%20plots/example/SARS_Russia_2024.png)
![plot](./annual%20lineage%20plots/example/SARS_Russia_2024_grouped.png)
![plot](./annual%20lineage%20plots/example/SARS_Russia_2024_grouped_binary.png)
